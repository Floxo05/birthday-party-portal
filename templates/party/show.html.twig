{% extends 'base.html.twig' %}

{% block title %}{{ party.title }}{% endblock %}

{% block body %}
    <section class="mb-2 pb-1 border-bottom">
        <div class="d-flex justify-content-between align-items-start flex-wrap">
            <div>
                <h1 class="mb-2">{{ party.title }}</h1>
                <p class="text-muted">{{ party.partyDate|date('d.m.Y') }}</p>
            </div>

            <div class="mt-2 mt-lg-0">
                {% include 'party/_status.html.twig' with { 'party': party, 'currentUser': currentUser } %}
            </div>
        </div>
    </section>

    <section class="mb-2 pb-2 border-bottom">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h2 class="h4 m-0 text-primary">Nachrichten</h2>
            {% set membership = party.partyMembers|filter(m => m.user == currentUser)|first %}
            {% if membership and membership.role == 'Host' %}
                <a href="{{ path('chat_rooms_list', {id: party.id}) }}" class="btn btn-sm btn-outline-secondary">Alle Chats</a>
            {% endif %}
        </div>

        {% include 'party/_news_summary.html.twig' with { 'news': news, 'statusMap': statusMap } %}

        {% if news|length > 0 %}
            <a href="{{ path('party_news_list', {id: party.id}) }}" class="btn btn-link mt-3">
                âž” Alle Nachrichten anzeigen
            </a>
        {% endif %}
    </section>

    <section class="mb-2">
        <h2 class="h4 mb-3 text-primary">Aktionen</h2>

        {% include 'party/_actions.html.twig' %}
    </section>

    {% if popupNews is not empty %}
        <div class="modal fade show d-block" tabindex="-1" style="background-color: rgba(0,0,0,0.5);">
            <div class="modal-dialog modal-lg modal-dialog-centered">
                <div class="modal-content shadow-lg">
                    <div class="modal-header">
                        <h5 class="modal-title">Wichtige Nachrichten</h5>
                        <a href="{{ app.request.uri }}" class="btn-close"></a> {# Fake close by reload #}
                    </div>
                    <div class="modal-body">
                        <div class="list-group mt-3">
                            {% for popup in popupNews %}
                                <a href="{{ path('party_news_detail', {id: popup.id}) }}"
                                   class="list-group-item list-group-item-action list-group-item-warning">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div class="d-flex flex-column">
                                            <h5 class="mb-1">{{ popup.text }}</h5>
                                            <small class="text-muted mt-2">{{ popup.createdAt|date('d.m.Y H:i') }}</small>
                                        </div>
                                    </div>
                                </a>
                                {% if not loop.last %}
                                    <hr>
                                {% endif %}
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    {% endif %}
{% endblock %}
